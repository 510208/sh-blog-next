---
import { getCollection } from "astro:content";
import BlogList from "../components/content/BlogList.astro";
import Greeting from "@/components/content/Greeting.astro";
import BaseLayout from "@/components/layouts/BaseLayout.astro";
import Hero from "@/components/content/Home/Hero.astro";
import Sidebar from "@/components/Sidebar.astro";
import BaseMainContent from "@/components/layouts/BaseMainContent.astro";
import { HeroSubtitle, HeroTitle } from "@/components/content/Home/HeroItems";
import { SITE_DESCRIPTION, SITE_TITLE } from "@/consts";

const posts = (
  await getCollection("blog", ({ data }) => {
    // 開發環境顯示所有文章,生產環境過濾掉 draft 文章
    if (import.meta.env.DEV) return true;
    return data.draft !== true;
  })
)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 6); // Get latest 6 posts

const featuredPost = posts[0];
const currentPage = Number(Astro.url.searchParams.get("page")) || 1;
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <!-- Hero Section -->
  <Hero>
    <!-- Left: Main heading -->
    <div class="lg:col-span-2" slot="left">
      <HeroTitle>
        正因為曾經淋過雨，<br />才會想為他人撐一把傘。
      </HeroTitle>
      <HeroSubtitle slot="right">
        <Greeting />
      </HeroSubtitle>
    </div>
  </Hero>

  <!-- Right: Featured article card -->
  <div class="flex flex-col justify-end gap-5" slot="right">
    {
      featuredPost && (
        <a
          href={`/blog/${featuredPost.id}/`}
          class="border border-white/20 rounded-xl overflow-hidden backdrop-blur-sm bg-black/30 hover:bg-black/50 transition-all group h-57.5 flex flex-col justify-end p-6"
          style={{
            backgroundImage: featuredPost.data.heroImage
              ? `url(${featuredPost.data.heroImage.src})`
              : "none",
            backgroundSize: "cover",
            backgroundBlendMode: "darken",
          }}
        >
          <p class="text-white/60 text-xl tracking-[4px] mb-2.5">最近更新</p>
          <h2 class="text-white text-4xl font-bold group-hover:text-white/90 transition-colors">
            {featuredPost.data.title}
          </h2>
        </a>
      )
    }
  </div>

  <!-- Main content section -->
  <BaseMainContent>
    <!-- Main column: Blog posts grid -->
    <div class="flex-1">
      <BlogList currentPage={currentPage} />
    </div>

    <!-- Sidebar -->
    <Sidebar />
  </BaseMainContent>
</BaseLayout>
