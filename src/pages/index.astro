---
import { getCollection } from "astro:content";
import Footer from "../components/core/Footer.astro";
import AuthorCard from "../components/content/AuthorCard.tsx";
import DiscordCard from "../components/content/DiscordCard.tsx";
import BlogList from "../components/content/BlogList.astro";
import Greeting from "@/components/content/Greeting.astro";
import BaseLayout from "@/components/core/BaseLayout.astro";
import Hero from "@/components/content/Home/Hero.astro";
import config from "shblog.config";
import Sidebar from "@/components/Sidebar.astro";

const posts = (await getCollection("blog"))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 6); // Get latest 6 posts

const featuredPost = posts[0];
const currentPage = Number(Astro.url.searchParams.get("page")) || 1;
---

<BaseLayout>
  <!-- Hero Section -->
  <Hero>
    <!-- Left: Main heading -->
    <div class="lg:col-span-2" slot="left">
      <h1 class="text-4xl md:text-6xl font-bold text-white leading-tight mb-4">
        正因為曾經淋過雨，<br />才會想為他人撐一把傘。
      </h1>
      <p class="text-2xl md:text-4xl text-white/40">
        <Greeting />
      </p>
    </div>

    <!-- Right: Featured article card -->
    <div class="flex flex-col justify-end gap-5" slot="right">
      {
        featuredPost && (
          <a
            href={`/blog/${featuredPost.id}/`}
            class="border border-white/20 rounded-xl overflow-hidden backdrop-blur-sm bg-black/30 hover:bg-black/50 transition-all group h-[230px] flex flex-col justify-end p-6"
            style={{
              backgroundImage: featuredPost.data.heroImage
                ? `url(${featuredPost.data.heroImage.src})`
                : "none",
              backgroundSize: "cover",
              backgroundBlendMode: "darken",
            }}
          >
            <p class="text-white/60 text-xl tracking-[4px] mb-2.5">最近更新</p>
            <h2 class="text-white text-4xl font-bold group-hover:text-white/90 transition-colors">
              {featuredPost.data.title}
            </h2>
          </a>
        )
      }
    </div>
  </Hero>

  <!-- Main content section -->
  <main class="px-4 py-10 flex-1 flex justify-center">
    <div
      class="w-full md:w-[80vw] md:min-w-3xl md:max-w-7xl flex flex-col lg:flex-row gap-10"
    >
      <!-- Main column: Blog posts grid -->
      <div class="flex-1">
        <BlogList currentPage={currentPage} />
      </div>

      <!-- Sidebar -->
      <Sidebar />
    </div>
  </main>
</BaseLayout>
