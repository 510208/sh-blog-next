---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import BaseHead from "../components/core/BaseHead.js";
import Footer from "../components/core/Footer.js";
import Header from "../components/core/Header.js";
import AuthorCard from "../components/content/AuthorCard.tsx";
import DiscordCard from "../components/content/DiscordCard.tsx";
import BlogList from "../components/content/BlogList.js";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";
import Greeting from "@/components/content/Greeting.js";
import BaseLayout from "@/components/core/BaseLayout.js";

const posts = (await getCollection("blog"))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 6); // Get latest 6 posts

const featuredPost = posts[0];
const currentPage = Number(Astro.url.searchParams.get("page")) || 1;
---

<BaseLayout>
  <!-- Hero Section -->
  <section class="relative h-[700px] px-4 py-10 overflow-hidden">
    <!-- Hero background image -->
    <div class="absolute inset-0 pointer-events-none">
      {
        featuredPost?.data.heroImage && (
          <Image
            src="/assets/layouts/homepage/samhacker_homepage_background.png"
            alt=""
            class="w-full h-full object-cover"
            width={1920}
            height={700}
          />
        )
      }
      <div class="absolute inset-0 bg-linear-to-b from-black/60 to-black"></div>
    </div>

    <!-- Hero content -->
    <div class="relative h-full flex items-end justify-center">
      <div class="w-full md:w-[80vw] md:min-w-3xl md:max-w-7xl">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
          <!-- Left: Main heading -->
          <div class="lg:col-span-2">
            <h1
              class="text-4xl md:text-6xl font-bold text-white leading-tight mb-4"
            >
              正因為曾經淋過雨，<br />才會想為他人撐一把傘。
            </h1>
            <p class="text-2xl md:text-4xl text-white/40">
              <Greeting />
            </p>
          </div>

          <!-- Right: Featured article card -->
          <div class="flex flex-col justify-end gap-5">
            {
              featuredPost && (
                <a
                  href={`/blog/${featuredPost.id}/`}
                  class="border border-white/20 rounded-xl overflow-hidden backdrop-blur-sm bg-black/30 hover:bg-black/50 transition-all group h-[230px] flex flex-col justify-end p-6"
                  style={{
                    backgroundImage: featuredPost.data.heroImage
                      ? `url(${featuredPost.data.heroImage.src})`
                      : "none",
                    backgroundSize: "cover",
                    // Dark overlay
                    backgroundBlendMode: "darken",
                  }}
                >
                  <p class="text-white/60 text-xl tracking-[4px] mb-2.5">
                    最近更新
                  </p>
                  <h2 class="text-white text-4xl font-bold group-hover:text-white/90 transition-colors">
                    {featuredPost.data.title}
                  </h2>
                </a>
              )
            }
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main content section -->
  <main class="px-4 py-10 flex-1 flex justify-center">
    <div
      class="w-full md:w-[80vw] md:min-w-3xl md:max-w-7xl flex flex-col lg:flex-row gap-10"
    >
      <!-- Main column: Blog posts grid -->
      <div class="flex-1">
        <BlogList currentPage={currentPage} />
      </div>

      <!-- Sidebar -->
      <aside class="w-full lg:w-[378px] flex flex-col gap-5">
        <!-- Author card -->
        <AuthorCard client:load />

        <!-- Discord cards -->
        <a
          href="https://discord.gg/CWCjhRGJ2e"
          target="_blank"
          rel="noopener noreferrer"
        >
          <DiscordCard
            client:load
            title="Discord"
            subtitle="加入我的討論群組！"
            description={`你遇到問題了嗎？&#10;加入我的群組「企鵝哥贛話中心」，和群裡的大神一起討論吧！`}
          />
        </a>
      </aside>
    </div>
  </main>

  <Footer />
</BaseLayout>
