---
import Giscus from "@giscus/react";

import config from "@shConfig";
import { Skeleton } from "@ui/skeleton";

const GISCUS_ENABLED = config.behavior.enableComment == "Giscus" || false;
const GISCUS_CONFIG = config.behavior.giscusConfig;
const UTTERANCES_ENABLED =
  config.behavior.enableComment == "Utterances" || false;
const UTTERANCES_CONFIG = config.behavior.utterancesConfig;
---

{
  GISCUS_ENABLED && (
    <Giscus
      id="comments"
      repo={GISCUS_CONFIG.repo}
      repoId={GISCUS_CONFIG.repoId}
      category={GISCUS_CONFIG.category}
      categoryId={GISCUS_CONFIG.categoryId}
      mapping={GISCUS_CONFIG.mapping}
      strict={GISCUS_CONFIG.strict}
      reactionsEnabled={GISCUS_CONFIG.reactionsEnabled}
      emitMetadata={GISCUS_CONFIG.emitMetadata}
      inputPosition={GISCUS_CONFIG.inputPosition}
      theme={GISCUS_CONFIG.theme}
      lang={GISCUS_CONFIG.lang}
      loading="lazy"
      client:only="react"
    >
      <div slot="fallback">
        {/* 使用Skeleton元件 */}
        <Skeleton />
      </div>
    </Giscus>
  )
}

{
  UTTERANCES_ENABLED && (
    <div id="comments utterances-container" />

    <script define:vars={{ UTTERANCES_CONFIG }}>
      const script = document.createElement("script");

      script.type = "text/javascript";
      script.src = "https://utteranc.es/client.js";

      script.setAttribute("repo", UTTERANCES_CONFIG.repo);
      script.setAttribute("issue-term", UTTERANCES_CONFIG.issueTerm);
      script.setAttribute("label", UTTERANCES_CONFIG.label);
      script.setAttribute("theme", UTTERANCES_CONFIG.theme);
      script.setAttribute("crossorigin", "anonymous");

      script.async = true;

      document.querySelector("#comments")?.appendChild(script);
    </script>
  )
}
